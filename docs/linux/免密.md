## 🔧 快速修复SSH免密登录

### 步骤1: 生成SSH密钥(如果还没有)

bash

```bash
# 检查是否已有密钥
ls ~/.ssh/id_rsa.pub

# 如果没有,生成一个(一路回车)
ssh-keygen -t rsa -b 4096
```

### 步骤2: 复制公钥到所有虚拟机

bash

```bash
# 先复制到control-1
ssh-copy-id vagrant@192.168.56.11
# 会提示输入密码,通常是: vagrant

# 然后复制到所有worker
ssh-copy-id vagrant@192.168.56.21
ssh-copy-id vagrant@192.168.56.22
ssh-copy-id vagrant@192.168.56.23
```

### 步骤3: 测试免密登录

bash

```bash
ssh vagrant@192.168.56.11 'echo "免密登录成功!"'
```

### 步骤4: 测试sudo(免密sudo应该是默认配置的)

bash

```bash
ssh vagrant@192.168.56.11 'sudo whoami'
```

应该输出 `root`,不需要密码。

## 我推荐方案2

最简单的方式:

bash

```bash
# 1. 配置SSH使用Vagrant的密钥
cat >> ~/.ssh/config << EOF
Host k8s-control-1
  HostName 192.168.56.11
  User vagrant
  IdentityFile /mnt/d/cai/k8s-cluster/vagrant/.vagrant/machines/control-1/virtualbox/private_key
  StrictHostKeyChecking no

Host k8s-worker-1
  HostName 192.168.56.21
  User vagrant
  IdentityFile /mnt/d/cai/k8s-cluster/vagrant/.vagrant/machines/worker-1/virtualbox/private_key
  StrictHostKeyChecking no

Host k8s-worker-2
  HostName 192.168.56.22
  User vagrant
  IdentityFile /mnt/d/cai/k8s-cluster/vagrant/.vagrant/machines/worker-2/virtualbox/private_key
  StrictHostKeyChecking no

Host k8s-worker-3
  HostName 192.168.56.23
  User vagrant
  IdentityFile /mnt/d/cai/k8s-cluster/vagrant/.vagrant/machines/worker-3/virtualbox/private_key
  StrictHostKeyChecking no
EOF

# 2. 测试
ssh k8s-control-1 'echo "连接成功!"'

# 3. 然后可以用这些别名操作
ssh k8s-control-1 'sudo whoami'
```

这样你就可以继续部署K3s了! 🚀

## 或者直接用方案1 (最可靠)

不依赖找私钥,直接通过Vagrant添加你的公钥:

bash

```bash
# 1. 确保在Vagrantfile目录
cd /mnt/d/cai/k8s-cluster/vagrant/

# 2. 复制公钥到control-1
cat /home/vagrant/.ssh/id_rsa.pub | vagrant ssh control-1 -c "mkdir -p ~/.ssh && chmod 700 ~/.ssh && cat >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys"

# 3. 对其他节点也做同样操作
cat /home/vagrant/.ssh/id_rsa.pub | vagrant ssh worker-1 -c "mkdir -p ~/.ssh && chmod 700 ~/.ssh && cat >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys"
cat /home/vagrant/.ssh/id_rsa.pub | vagrant ssh worker-2 -c "mkdir -p ~/.ssh && chmod 700 ~/.ssh && cat >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys"
cat /home/vagrant/.ssh/id_rsa.pub | vagrant ssh worker-3 -c "mkdir -p ~/.ssh && chmod 700 ~/.ssh && cat >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys"

# 4. 测试SSH连接
ssh vagrant@192.168.56.11 'echo "免密登录成功!"'
```

这个方案不需要找私钥文件,直接用Vagrant的访问权限来添加你的公钥。

